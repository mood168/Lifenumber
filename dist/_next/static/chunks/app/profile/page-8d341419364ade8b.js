(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{6660:function(e,t,r){Promise.resolve().then(r.bind(r,112))},4710:function(e,t,r){"use strict";r.d(t,{default:function(){return d}});var a=r(7437),s=r(2265),n=r(7648),l=r(9376),c=r(9089),i=r(6501),o=()=>{let e=(0,l.usePathname)(),{isAdmin:t}=(0,i.a)(),r=[{icon:c.xng,label:"首頁",path:"/"},{icon:c.nGB,label:"課程",path:"/classcourse"},{icon:c.QJe,label:"運勢",path:"/daily"},{icon:c.Xws,label:"我的",path:"/profile"},{icon:c.p4t,label:"設定",path:"/settings"},...t?[{icon:c.W95,label:"報名管理",path:"/admin/bookings"}]:[]];return(0,a.jsx)("div",{className:"fixed bottom-0 w-full bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 z-50",children:(0,a.jsx)("div",{className:"flex justify-around items-center h-[83px] px-6 pb-8 pt-2",children:r.map(t=>{let r=e===t.path;return(0,a.jsxs)(n.default,{href:t.path,className:"flex flex-col items-center space-y-1 ".concat(r?"text-purple-600":"text-gray-500"),children:[(0,a.jsx)(t.icon,{className:"h-6 w-6"}),(0,a.jsx)("span",{className:"text-xs",children:t.label})]},t.path)})})})},d=e=>{let{children:t}=e;return(0,s.useEffect)(()=>{console.log("Layout 組件已渲染")},[]),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,a.jsx)("main",{className:"pb-[83px]",children:t}),(0,a.jsx)(o,{})]})}},6501:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return o},a:function(){return d}});var a=r(7437),s=r(2265),n=r(3301),l=r(1361),c=r(5978);let i=(0,s.createContext)({user:null,loading:!0,isAdmin:!1,logout:async()=>{}}),o=e=>{let{children:t}=e,[r,o]=(0,s.useState)(null),[d,u]=(0,s.useState)(!0),[x,h]=(0,s.useState)(!1),m=async e=>{try{let t=await (0,c.QT)((0,c.JU)(l.db,"users",e));t.exists()&&h(!0===t.data().isAdmin)}catch(e){console.error("Error checking admin status:",e),h(!1)}};(0,s.useEffect)(()=>{let e=(0,n.Aj)(l.I,async e=>{o(e),e?await m(e.uid):h(!1),u(!1)});return()=>e()},[]);let p=async()=>{u(!0);try{await (0,n.w7)(l.I),o(null),console.log("User logged out successfully.")}catch(e){console.error("Error signing out:",e)}finally{u(!1)}};return(0,a.jsx)(i.Provider,{value:{user:r,loading:d,logout:p,isAdmin:x},children:t})},d=()=>(0,s.useContext)(i)},112:function(e,t,r){"use strict";r.r(t);var a=r(7437),s=r(2265),n=r(4710),l=r(9089),c=r(6501),i=r(9376),o=r(5326),d=r(5978),u=r(3145);let x=e=>e?(e instanceof d.EK?e.toDate():new Date(e)).toLocaleString("zh-TW"):"日期不可用";t.default=()=>{var e;let{user:t,logout:r}=(0,c.a)(),d=(0,i.useRouter)(),[h,m]=(0,s.useState)(null),[p,b]=(0,s.useState)(!1),[g,f]=(0,s.useState)(null),[y,j]=(0,s.useState)([]),N=(0,s.useCallback)(async()=>{if(null==t?void 0:t.uid)try{let e=await (0,o.et)(t.uid);e&&m(e)}catch(e){console.error("Error loading profile:",e)}},[t]),w=(0,s.useCallback)(async()=>{if(null==t?void 0:t.uid)try{let e=await (0,o.p5)(t.uid);j(e)}catch(e){console.error("Error fetching history:",e)}},[t]);(0,s.useEffect)(()=>{t&&N()},[t,N]),(0,s.useEffect)(()=>{t&&w()},[t,w]);let[v,k]=(0,s.useState)(!1),[E,I]=(0,s.useState)({}),[D,S]=(0,s.useState)(!0),C=e=>{let{name:t,value:r}=e.target;I(e=>({...e,[t]:r}))},J=async e=>{if(e.preventDefault(),t){b(!0);try{await (0,o.Lj)(t.uid,E)?(f({type:"success",text:"個人資料更新成功！"}),N(),k(!1)):f({type:"error",text:"更新失敗，請稍後再試。"})}catch(e){console.error("Error updating profile:",e),f({type:"error",text:"更新資料時發生錯誤"})}finally{b(!1)}}},U=async e=>{t&&t.uid&&e&&window.confirm("確定要刪除此條記錄嗎？")&&(S(!0),await (0,o.Uh)(t.uid,e)?(j(t=>t.filter(t=>t.id!==e)),alert("記錄已刪除。")):alert("刪除記錄失敗。"),S(!1))},A=async()=>{t&&t.uid&&window.confirm("警告：確定要刪除所有歷史記錄嗎？此操作無法復原！")&&(S(!0),await (0,o.sV)(t.uid)?(j([]),alert("所有歷史記錄已刪除。")):alert("刪除所有歷史記錄失敗。"),S(!1))};return t?(0,a.jsx)(n.default,{children:(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[t.photoURL?(0,a.jsx)("div",{className:"relative w-20 h-20",children:(0,a.jsx)(u.default,{src:t.photoURL,alt:t.displayName||"用戶",fill:!0,sizes:"80px",className:"rounded-full object-cover border-2 border-purple-400"})}):(0,a.jsx)("div",{className:"w-20 h-20 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-2xl text-purple-600 dark:text-purple-400",children:null===(e=t.displayName)||void 0===e?void 0:e.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:t.displayName||"用戶"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:t.email||"未設置電子郵件"})]})]}),(0,a.jsxs)("button",{onClick:()=>{r(),d.push("/auth/login")},className:"flex items-center space-x-1 px-3 py-2 text-sm text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:[(0,a.jsx)(l.fHX,{}),(0,a.jsx)("span",{children:"登出"})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:v?(0,a.jsxs)("form",{onSubmit:J,className:"mt-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-black dark:text-white",children:"登入名稱"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(l.Xws,{className:"absolute left-3 top-3 text-gray-400"}),(0,a.jsx)("input",{type:"text",name:"loginName",value:E.loginName||t.displayName||"",onChange:C,className:"pl-10 w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-300",required:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-black dark:text-white",children:"電子郵件"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(l.SRX,{className:"absolute left-3 top-3 text-gray-400"}),(0,a.jsx)("input",{type:"email",name:"email",value:E.email||t.email||"",onChange:C,className:"pl-10 w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-300",required:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-black dark:text-white",children:"真實姓名"}),(0,a.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-300",children:"計算每日運勢用,必填"})]}),(0,a.jsx)("input",{type:"text",name:"realName",value:E.realName||"",onChange:C,className:"w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-300",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-black dark:text-white",children:"出生日期"}),(0,a.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-300",children:"計算每日運勢用,必填"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(l.XdU,{className:"absolute left-3 top-3 text-gray-400"}),(0,a.jsx)("input",{type:"date",name:"birthDate",value:E.birthDate||"",onChange:C,className:"pl-10 w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-300",required:!0})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-black dark:text-white",children:"性別"}),(0,a.jsx)("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded dark:bg-blue-900 dark:text-blue-300",children:"計算每日運勢用,必填"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(l.C55,{className:"absolute left-3 top-3 text-gray-400"}),(0,a.jsxs)("select",{name:"gender",value:E.gender||"",onChange:C,className:"pl-10 w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 text-gray-700 dark:text-gray-300",required:!0,children:[(0,a.jsx)("option",{value:"",children:"請選擇性別"}),(0,a.jsx)("option",{value:"male",children:"男性"}),(0,a.jsx)("option",{value:"female",children:"女性"}),(0,a.jsx)("option",{value:"other",children:"其他"})]})]})]}),(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)("button",{type:"submit",disabled:p,className:"flex-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600 disabled:bg-blue-300",children:p?"儲存中...":"儲存"}),(0,a.jsx)("button",{type:"button",onClick:()=>k(!1),className:"flex-1 bg-gray-200 text-gray-700 p-2 rounded hover:bg-gray-300",children:"取消"})]})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"border rounded p-4 space-y-2 text-black dark:text-white",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-black dark:text-white",children:"真實姓名："}),(null==h?void 0:h.realName)||(0,a.jsx)("span",{className:"text-red-300",children:"計算每日運勢用,必填"})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-black dark:text-white",children:"出生日期："}),(null==h?void 0:h.birthDate)||(0,a.jsx)("span",{className:"text-red-300",children:"計算每日運勢用,必填"})]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-black dark:text-white",children:"性別："}),(null==h?void 0:h.gender)?({male:"男性",female:"女性",other:"其他"})[h.gender]:(0,a.jsx)("span",{className:"text-red-300",children:"計算每日運勢用,必填"})]})]}),(0,a.jsx)("button",{onClick:()=>k(!0),className:"w-full ".concat((null==h?void 0:h.realName)&&(null==h?void 0:h.birthDate)&&(null==h?void 0:h.gender)?"bg-blue-500 hover:bg-blue-600":"bg-red-500 hover:bg-red-600"," text-white p-2 rounded"),children:(null==h?void 0:h.realName)&&(null==h?void 0:h.birthDate)&&(null==h?void 0:h.gender)?"編輯個人資料":"完善個人資料"})]})}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-4",children:[{icon:l.ceS,label:"歷史記錄",count:y.length.toString()},{icon:l.Op,label:"運勢分析",count:"-"},{icon:l.Lrt,label:"分享",count:"-"}].map((e,t)=>(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-xl text-center shadow-sm border border-gray-100 dark:border-gray-700",children:[(0,a.jsx)(e.icon,{className:"w-6 h-6 mx-auto text-purple-600 dark:text-purple-400"}),(0,a.jsx)("div",{className:"mt-2 font-semibold text-gray-900 dark:text-white",children:e.count}),(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.label})]},t))}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"計算歷史"}),(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-purple-600 dark:text-purple-400",children:"計算歷史記錄"}),(0,a.jsx)("button",{onClick:A,disabled:D||0===y.length,className:"px-3 py-1 text-sm bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-300 ".concat(D||0===y.length?"opacity-50 cursor-not-allowed":""),children:"刪除全部記錄"})]}),D?(0,a.jsx)("p",{className:"text-center text-gray-600 dark:text-gray-300",children:"正在加載歷史記錄..."}):y.length>0?(0,a.jsx)("ul",{className:"space-y-3",children:y.map(e=>(0,a.jsxs)("li",{className:"border border-gray-200 dark:border-gray-700 p-3 rounded-lg flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-semibold text-gray-800 dark:text-gray-200",children:["生日: ",e.birthdate]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["計算日期: ",x(e.date)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["生命密碼: ",e.lifeNumber]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["天賦數: ",e.talentNumber]}),(0,a.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["生日數: ",e.birthNumber]})]}),(0,a.jsx)("button",{onClick:()=>U(e.id),disabled:D,className:"ml-4 px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600 transition-colors duration-300 ".concat(D?"opacity-50 cursor-not-allowed":""),children:"刪除"})]},e.id))}):(0,a.jsx)("p",{className:"text-center text-gray-600 dark:text-gray-300",children:"尚無歷史記錄。"})]}),g&&(0,a.jsx)("div",{className:"mt-4 p-3 rounded ".concat("success"===g.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:g.text})]})}):(0,a.jsx)(n.default,{children:(0,a.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,a.jsx)("p",{children:"請先登入"})})})}},5326:function(e,t,r){"use strict";r.d(t,{a4:function(){return N},bq:function(){return x},jt:function(){return i},sV:function(){return u},A:function(){return b},Uh:function(){return d},aL:function(){return f},XR:function(){return m},Ho:function(){return h},zm:function(){return k},p5:function(){return o},et:function(){return w},isAdminUser:function(){return j},HP:function(){return E},xO:function(){return g},i1:function(){return y},Hf:function(){return p},Lj:function(){return v}});var a=r(738),s=r(5978),n=r(3301);let l=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),c=(0,s.ad)(l);(0,n.v0)(l);let i=async(e,t,r)=>{if(!e)return console.error("User ID is required to add history entry."),null;try{let a={userId:e,date:s.EK.fromDate(new Date),...r,birthdate:t},n=await (0,s.ET)((0,s.hJ)(c,"userHistory",e,"entries"),a);return console.log("History entry written with ID: ",n.id),n.id}catch(e){return console.error("Error adding document: ",e),null}},o=async e=>{if(!e)return console.error("User ID is required to get history."),[];try{let t=(0,s.hJ)(c,"userHistory",e,"entries"),r=(0,s.IO)(t,(0,s.Xo)("date","desc"),(0,s.b9)(20)),a=await (0,s.PL)(r),n=[];return a.forEach(e=>{n.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(n.length," history entries for user ").concat(e)),n}catch(e){return console.error("Error getting documents: ",e),[]}},d=async(e,t)=>{if(!e||!t)return console.error("User ID and Entry ID are required to delete history entry."),!1;try{return await (0,s.oe)((0,s.JU)(c,"userHistory",e,"entries",t)),console.log("History entry with ID: ".concat(t," deleted successfully for user ").concat(e,".")),!0}catch(e){return console.error("Error deleting document: ",e),!1}},u=async e=>{if(!e)return console.error("User ID is required to delete all history."),!1;try{let t=(0,s.hJ)(c,"userHistory",e,"entries"),r=(0,s.IO)(t),a=await (0,s.PL)(r),n=[];return a.forEach(e=>{n.push((0,s.oe)(e.ref))}),await Promise.all(n),console.log("All history entries deleted successfully for user ".concat(e,".")),!0}catch(e){return console.error("Error deleting all user history: ",e),!1}},x=async e=>{try{let t=await (0,s.ET)((0,s.hJ)(c,"courses"),{...e,createdAt:s.EK.fromDate(new Date)});return console.log("Course written with ID: ",t.id),t.id}catch(e){return console.error("Error adding course document: ",e),null}},h=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"date",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"desc";try{let r=(0,s.hJ)(c,"courses"),a=(0,s.IO)(r,(0,s.Xo)(e,t)),n=await (0,s.PL)(a),l=[];return n.forEach(e=>{l.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(l.length," courses")),l}catch(e){return console.error("Error getting course documents: ",e),[]}},m=async e=>{if(!e)return null;try{let t=(0,s.JU)(c,"courses",e),r=await (0,s.QT)(t);if(r.exists())return{id:r.id,...r.data()};return console.log("No such course document!"),null}catch(e){return console.error("Error getting course document: ",e),null}},p=async(e,t)=>{if(!e)return!1;try{let r=(0,s.JU)(c,"courses",e);return await (0,s.r7)(r,t),console.log("Course with ID: ".concat(e," updated successfully.")),!0}catch(e){return console.error("Error updating course document: ",e),!1}},b=async e=>{if(!e)return!1;try{return await (0,s.oe)((0,s.JU)(c,"courses",e)),console.log("Course with ID: ".concat(e," deleted successfully.")),!0}catch(e){return console.error("Error deleting course document: ",e),!1}},g=async e=>{let t=(0,s.hJ)(c,"bookings");return(await (0,s.ET)(t,e)).id},f=async()=>{let e=(0,s.hJ)(c,"bookings"),t=(0,s.IO)(e,(0,s.Xo)("createdAt","desc"));return(await (0,s.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))},y=async(e,t)=>{let r=(0,s.JU)(c,"bookings",e);await (0,s.r7)(r,{status:t})};async function j(e){try{let t=(0,s.hJ)(c,"admin_users"),r=(0,s.IO)(t,(0,s.ar)("email","==",e));return!(await (0,s.PL)(r)).empty}catch(e){return console.error("檢查管理員狀態時發生錯誤:",e),!1}}async function N(e){try{let t=(0,s.hJ)(c,"admin_users");await (0,s.ET)(t,{email:e,createdAt:new Date().toISOString()})}catch(e){throw console.error("添加管理員時發生錯誤:",e),e}}let w=async e=>{if(!e)return null;try{let t=(0,s.JU)(c,"user_profiles",e),r=await (0,s.QT)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){return console.error("獲取用戶資料時發生錯誤:",e),null}},v=async(e,t)=>{if(!e)return!1;try{let r=(0,s.JU)(c,"user_profiles",e),a=new Date().toISOString();return(await (0,s.QT)(r)).exists()?await (0,s.r7)(r,{...t,updatedAt:a}):await (0,s.pl)(r,{...t,createdAt:a,updatedAt:a}),!0}catch(e){return console.error("更新用戶資料時發生錯誤:",e),!1}},k=async e=>{if(!e)return null;try{let t=new Date().toISOString().split("T")[0],r=(0,s.hJ)(c,"deepseek_answer"),a=(0,s.IO)(r,(0,s.ar)("userId","==",e),(0,s.ar)("date","==",t),(0,s.b9)(1)),n=await (0,s.PL)(a);if(!n.empty){let e=n.docs[0];return{id:e.id,...e.data()}}return null}catch(e){return console.error("Error getting deepseek answer:",e),null}},E=async e=>{try{return(await (0,s.ET)((0,s.hJ)(c,"deepseek_answer"),{...e,createdAt:s.EK.fromDate(new Date)})).id}catch(e){return console.error("Error saving deepseek answer:",e),null}}},1361:function(e,t,r){"use strict";r.d(t,{I:function(){return c},db:function(){return i}});var a=r(738),s=r(3301),n=r(5978);let l=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),c=(0,s.v0)(l),i=(0,n.ad)(l)}},function(e){e.O(0,[358,982,699,943,705,145,971,117,744],function(){return e(e.s=6660)}),_N_E=e.O()}]);