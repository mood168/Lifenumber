(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{980:function(e,t,r){Promise.resolve().then(r.bind(r,4243))},4243:function(e,t,r){"use strict";r.r(t);var n=r(7437),s=r(2265),a=r(4710),o=r(9089),i=r(3145),c=r(7648),l=r(5326),u=r(6501);t.default=()=>{let[e,t]=(0,s.useState)([]),[d,h]=(0,s.useState)(!0),{user:m,loading:f}=(0,u.a)();(0,s.useEffect)(()=>{(async()=>{h(!0);try{let e=await (0,l.Ho)("date","asc"),r=new Date;r.setHours(0,0,0,0);let n=e.filter(e=>{try{let[t,n,s]=e.date.split("/").map(Number),a=new Date(t,n-1,s);return a.setHours(0,0,0,0),a>=r}catch(t){return console.error("解析課程日期時發生錯誤: ".concat(e.date),t),!1}});t(n)}catch(e){console.error("獲取課程時發生錯誤:",e),t([])}finally{h(!1)}})()},[]);let[x,p]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=async()=>{if(m&&m.email)try{let{isAdminUser:e}=await Promise.resolve().then(r.bind(r,5326)),t=await e(m.email);p(t)}catch(e){console.error("檢查管理員狀態時發生錯誤:",e),p(!1)}else p(!1)};f||e()},[m,f]),(0,n.jsx)(a.default,{children:(0,n.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,n.jsxs)("div",{className:"flex justify-center items-center mb-6 relative",children:[" ",(0,n.jsx)("h1",{className:"text-3xl font-bold text-center text-purple-700 dark:text-purple-300",children:"最新課程"}),!f&&x&&(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)(c.default,{href:"/admin/courses",className:"px-3 py-1.5 bg-indigo-600 text-white text-xs sm:text-sm rounded-md hover:bg-indigo-700 transition-colors duration-300 flex items-center whitespace-nowrap",children:[(0,n.jsx)(o.p4t,{className:"mr-1 hidden sm:inline"}),"課程管理"]}),(0,n.jsxs)(c.default,{href:"/admin/bookings",className:"px-3 py-1.5 bg-indigo-600 text-white text-xs sm:text-sm rounded-md hover:bg-indigo-700 transition-colors duration-300 flex items-center whitespace-nowrap",children:[(0,n.jsx)(o.p4t,{className:"mr-1 hidden sm:inline"}),"報名管理"]}),m&&"mood1app2023@gmail.com"===m.email&&(0,n.jsxs)(c.default,{href:"/admin/setup",className:"px-3 py-1.5 bg-indigo-600 text-white text-xs sm:text-sm rounded-md hover:bg-indigo-700 transition-colors duration-300 flex items-center whitespace-nowrap",children:[(0,n.jsx)(o.p4t,{className:"mr-1 hidden sm:inline"}),"設置"]})]})]}),d?(0,n.jsx)("div",{className:"text-center py-10",children:(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"正在加載課程..."})}):e.length>0?(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden flex flex-col transform transition duration-300 hover:scale-105",children:[(0,n.jsxs)("div",{className:"relative h-48 w-full",children:[(0,n.jsx)(i.default,{src:e.image||"/placeholder-image.jpg",alt:e.title,fill:!0,style:{objectFit:"cover"},className:"transition-opacity duration-300"}),e.tag&&(0,n.jsx)("span",{className:"absolute top-2 right-2 px-2 py-1 text-xs font-semibold text-white rounded ".concat("熱門"===e.tag?"bg-red-500":"額滿"===e.tag?"bg-gray-500":"bg-blue-500"),children:e.tag})]}),(0,n.jsxs)("div",{className:"p-4 flex flex-col flex-grow",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:e.title}),(0,n.jsx)("p",{className:"text-sm text-purple-600 dark:text-purple-400 mb-2",children:e.subtitle}),(0,n.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-3 flex-grow",children:e.description}),(0,n.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 space-y-1 mb-3",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(o.I$,{className:"mr-1.5"}),e.instructor," | ",e.duration]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(o.QJe,{className:"mr-1.5 text-yellow-500"}),e.rating," (",e.students," 位學員)"]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(o.Nh4,{className:"mr-1.5"}),e.location]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(o.XdU,{className:"mr-1.5"}),e.date]})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-auto pt-3 border-t border-gray-200 dark:border-gray-700",children:[(0,n.jsx)("span",{className:"text-lg font-bold text-purple-700 dark:text-purple-300",children:e.price}),(0,n.jsx)(c.default,{href:"/booking/".concat(e.id),className:"px-4 py-2 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700 transition-colors duration-300",children:"立即報名"})]})]})]},e.id||e.title))}):(0,n.jsx)("div",{className:"text-center py-10",children:(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"目前沒有可顯示的課程。"})})]})})}},4710:function(e,t,r){"use strict";r.d(t,{default:function(){return u}});var n=r(7437),s=r(2265),a=r(7648),o=r(9376),i=r(9089),c=r(6501),l=()=>{let e=(0,o.usePathname)(),{isAdmin:t}=(0,c.a)(),r=[{icon:i.xng,label:"首頁",path:"/"},{icon:i.nGB,label:"課程",path:"/classcourse"},{icon:i.QJe,label:"運勢",path:"/daily"},{icon:i.Xws,label:"我的",path:"/profile"},{icon:i.p4t,label:"設定",path:"/settings"},...t?[{icon:i.W95,label:"報名管理",path:"/admin/bookings"}]:[]];return(0,n.jsx)("div",{className:"fixed bottom-0 w-full bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 z-50",children:(0,n.jsx)("div",{className:"flex justify-around items-center h-[83px] px-6 pb-8 pt-2",children:r.map(t=>{let r=e===t.path;return(0,n.jsxs)(a.default,{href:t.path,className:"flex flex-col items-center space-y-1 ".concat(r?"text-purple-600":"text-gray-500"),children:[(0,n.jsx)(t.icon,{className:"h-6 w-6"}),(0,n.jsx)("span",{className:"text-xs",children:t.label})]},t.path)})})})},u=e=>{let{children:t}=e;return(0,s.useEffect)(()=>{console.log("Layout 組件已渲染")},[]),(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,n.jsx)("main",{className:"pb-[83px]",children:t}),(0,n.jsx)(l,{})]})}},6501:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return l},a:function(){return u}});var n=r(7437),s=r(2265),a=r(3301),o=r(1361),i=r(5978);let c=(0,s.createContext)({user:null,loading:!0,isAdmin:!1,logout:async()=>{}}),l=e=>{let{children:t}=e,[r,l]=(0,s.useState)(null),[u,d]=(0,s.useState)(!0),[h,m]=(0,s.useState)(!1),f=async e=>{try{let t=await (0,i.QT)((0,i.JU)(o.db,"users",e));t.exists()&&m(!0===t.data().isAdmin)}catch(e){console.error("Error checking admin status:",e),m(!1)}};(0,s.useEffect)(()=>{let e=(0,a.Aj)(o.I,async e=>{l(e),e?await f(e.uid):m(!1),d(!1)});return()=>e()},[]);let x=async()=>{d(!0);try{await (0,a.w7)(o.I),l(null),console.log("User logged out successfully.")}catch(e){console.error("Error signing out:",e)}finally{d(!1)}};return(0,n.jsx)(c.Provider,{value:{user:r,loading:u,logout:x,isAdmin:h},children:t})},u=()=>(0,s.useContext)(c)},5326:function(e,t,r){"use strict";r.d(t,{a4:function(){return j},bq:function(){return h},jt:function(){return c},sV:function(){return d},A:function(){return p},Uh:function(){return u},aL:function(){return y},XR:function(){return f},Ho:function(){return m},zm:function(){return I},p5:function(){return l},et:function(){return N},isAdminUser:function(){return w},HP:function(){return E},xO:function(){return g},i1:function(){return b},Hf:function(){return x},Lj:function(){return v}});var n=r(738),s=r(5978),a=r(3301);let o=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),i=(0,s.ad)(o);(0,a.v0)(o);let c=async(e,t,r)=>{if(!e)return console.error("User ID is required to add history entry."),null;try{let n={userId:e,date:s.EK.fromDate(new Date),...r,birthdate:t},a=await (0,s.ET)((0,s.hJ)(i,"userHistory",e,"entries"),n);return console.log("History entry written with ID: ",a.id),a.id}catch(e){return console.error("Error adding document: ",e),null}},l=async e=>{if(!e)return console.error("User ID is required to get history."),[];try{let t=(0,s.hJ)(i,"userHistory",e,"entries"),r=(0,s.IO)(t,(0,s.Xo)("date","desc"),(0,s.b9)(20)),n=await (0,s.PL)(r),a=[];return n.forEach(e=>{a.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(a.length," history entries for user ").concat(e)),a}catch(e){return console.error("Error getting documents: ",e),[]}},u=async(e,t)=>{if(!e||!t)return console.error("User ID and Entry ID are required to delete history entry."),!1;try{return await (0,s.oe)((0,s.JU)(i,"userHistory",e,"entries",t)),console.log("History entry with ID: ".concat(t," deleted successfully for user ").concat(e,".")),!0}catch(e){return console.error("Error deleting document: ",e),!1}},d=async e=>{if(!e)return console.error("User ID is required to delete all history."),!1;try{let t=(0,s.hJ)(i,"userHistory",e,"entries"),r=(0,s.IO)(t),n=await (0,s.PL)(r),a=[];return n.forEach(e=>{a.push((0,s.oe)(e.ref))}),await Promise.all(a),console.log("All history entries deleted successfully for user ".concat(e,".")),!0}catch(e){return console.error("Error deleting all user history: ",e),!1}},h=async e=>{try{let t=await (0,s.ET)((0,s.hJ)(i,"courses"),{...e,createdAt:s.EK.fromDate(new Date)});return console.log("Course written with ID: ",t.id),t.id}catch(e){return console.error("Error adding course document: ",e),null}},m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"date",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"desc";try{let r=(0,s.hJ)(i,"courses"),n=(0,s.IO)(r,(0,s.Xo)(e,t)),a=await (0,s.PL)(n),o=[];return a.forEach(e=>{o.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(o.length," courses")),o}catch(e){return console.error("Error getting course documents: ",e),[]}},f=async e=>{if(!e)return null;try{let t=(0,s.JU)(i,"courses",e),r=await (0,s.QT)(t);if(r.exists())return{id:r.id,...r.data()};return console.log("No such course document!"),null}catch(e){return console.error("Error getting course document: ",e),null}},x=async(e,t)=>{if(!e)return!1;try{let r=(0,s.JU)(i,"courses",e);return await (0,s.r7)(r,t),console.log("Course with ID: ".concat(e," updated successfully.")),!0}catch(e){return console.error("Error updating course document: ",e),!1}},p=async e=>{if(!e)return!1;try{return await (0,s.oe)((0,s.JU)(i,"courses",e)),console.log("Course with ID: ".concat(e," deleted successfully.")),!0}catch(e){return console.error("Error deleting course document: ",e),!1}},g=async e=>{let t=(0,s.hJ)(i,"bookings");return(await (0,s.ET)(t,e)).id},y=async()=>{let e=(0,s.hJ)(i,"bookings"),t=(0,s.IO)(e,(0,s.Xo)("createdAt","desc"));return(await (0,s.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))},b=async(e,t)=>{let r=(0,s.JU)(i,"bookings",e);await (0,s.r7)(r,{status:t})};async function w(e){try{let t=(0,s.hJ)(i,"admin_users"),r=(0,s.IO)(t,(0,s.ar)("email","==",e));return!(await (0,s.PL)(r)).empty}catch(e){return console.error("檢查管理員狀態時發生錯誤:",e),!1}}async function j(e){try{let t=(0,s.hJ)(i,"admin_users");await (0,s.ET)(t,{email:e,createdAt:new Date().toISOString()})}catch(e){throw console.error("添加管理員時發生錯誤:",e),e}}let N=async e=>{if(!e)return null;try{let t=(0,s.JU)(i,"user_profiles",e),r=await (0,s.QT)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){return console.error("獲取用戶資料時發生錯誤:",e),null}},v=async(e,t)=>{if(!e)return!1;try{let r=(0,s.JU)(i,"user_profiles",e),n=new Date().toISOString();return(await (0,s.QT)(r)).exists()?await (0,s.r7)(r,{...t,updatedAt:n}):await (0,s.pl)(r,{...t,createdAt:n,updatedAt:n}),!0}catch(e){return console.error("更新用戶資料時發生錯誤:",e),!1}},I=async e=>{if(!e)return null;try{let t=new Date().toISOString().split("T")[0],r=(0,s.hJ)(i,"deepseek_answer"),n=(0,s.IO)(r,(0,s.ar)("userId","==",e),(0,s.ar)("date","==",t),(0,s.b9)(1)),a=await (0,s.PL)(n);if(!a.empty){let e=a.docs[0];return{id:e.id,...e.data()}}return null}catch(e){return console.error("Error getting deepseek answer:",e),null}},E=async e=>{try{return(await (0,s.ET)((0,s.hJ)(i,"deepseek_answer"),{...e,createdAt:s.EK.fromDate(new Date)})).id}catch(e){return console.error("Error saving deepseek answer:",e),null}}},1361:function(e,t,r){"use strict";r.d(t,{I:function(){return i},db:function(){return c}});var n=r(738),s=r(3301),a=r(5978);let o=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),i=(0,s.v0)(o),c=(0,a.ad)(o)}},function(e){e.O(0,[358,982,699,943,705,145,971,117,744],function(){return e(e.s=980)}),_N_E=e.O()}]);