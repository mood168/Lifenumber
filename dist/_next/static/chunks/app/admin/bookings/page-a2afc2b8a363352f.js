(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[424],{9375:function(e,r,t){Promise.resolve().then(t.bind(t,2813))},2813:function(e,r,t){"use strict";t.r(r);var n=t(7437),s=t(2265),a=t(4710),c=t(6501),o=t(5326),i=t(9089);r.default=()=>{let[e,r]=(0,s.useState)([]),[t,l]=(0,s.useState)(!0),{user:u,loading:d}=(0,c.a)(),[h,g]=(0,s.useState)(null),x=async()=>{l(!0);try{let e=await (0,o.aL)();r(e)}catch(e){console.error("獲取報名數據時發生錯誤:",e)}finally{l(!1)}};(0,s.useEffect)(()=>{let e=async()=>{if(u){let e=await (0,o.isAdminUser)(u.email||"");g(e),e&&x()}else g(!1)};d||e()},[u,d]);let f=async(e,t)=>{try{await (0,o.i1)(e,t),r(r=>r.map(r=>r.id===e?{...r,status:t}:r))}catch(e){console.error("Error updating booking status:",e)}};return null===h||d?(0,n.jsx)(a.default,{children:(0,n.jsx)("div",{className:"text-center p-4",children:"檢查權限中..."})}):h?(0,n.jsx)(a.default,{children:(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-center mb-6 text-purple-700 dark:text-purple-300",children:"報名管理"}),t?(0,n.jsx)("p",{className:"text-center",children:"載入中..."}):e.length>0?(0,n.jsx)("div",{className:"grid gap-4",children:e.map(e=>(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-lg",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.courseTitle}),(0,n.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["報名時間: ",new Date(e.createdAt).toLocaleString()]})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:"pending"===e.status&&e.id?(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>f(e.id,"approved"),className:"p-2 bg-green-500 text-white rounded-lg hover:bg-green-600",title:"核准",children:(0,n.jsx)(i.l_A,{})}),(0,n.jsx)("button",{onClick:()=>f(e.id,"rejected"),className:"p-2 bg-red-500 text-white rounded-lg hover:bg-red-600",title:"拒絕",children:(0,n.jsx)(i.aHS,{})})]}):(0,n.jsx)("span",{className:"px-3 py-1 rounded-full text-sm ".concat("approved"===e.status?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:"approved"===e.status?"已核准":"已拒絕"})})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-900 dark:text-gray-100",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{className:"text-gray-700 dark:text-gray-300",children:"姓名："}),e.name]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{className:"text-gray-700 dark:text-gray-300",children:"Email："}),e.email]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{className:"text-gray-700 dark:text-gray-300",children:"電話："}),e.phone]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{className:"text-gray-700 dark:text-gray-300",children:"報名人數："}),e.participants]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{className:"text-gray-700 dark:text-gray-300",children:"備註："}),e.notes||"無"]})]})]})]},e.id))}):(0,n.jsx)("p",{className:"text-center text-gray-700 dark:text-gray-500",children:"目前沒有報名記錄"})]})}):(0,n.jsx)(a.default,{children:(0,n.jsx)("div",{className:"text-center p-4",children:"您沒有權限訪問此頁面。"})})}},4710:function(e,r,t){"use strict";t.d(r,{default:function(){return u}});var n=t(7437),s=t(2265),a=t(7648),c=t(9376),o=t(9089),i=t(6501),l=()=>{let e=(0,c.usePathname)(),{isAdmin:r}=(0,i.a)(),t=[{icon:o.xng,label:"首頁",path:"/"},{icon:o.nGB,label:"課程",path:"/classcourse"},{icon:o.QJe,label:"運勢",path:"/daily"},{icon:o.Xws,label:"我的",path:"/profile"},{icon:o.p4t,label:"設定",path:"/settings"},...r?[{icon:o.W95,label:"報名管理",path:"/admin/bookings"}]:[]];return(0,n.jsx)("div",{className:"fixed bottom-0 w-full bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 z-50",children:(0,n.jsx)("div",{className:"flex justify-around items-center h-[83px] px-6 pb-8 pt-2",children:t.map(r=>{let t=e===r.path;return(0,n.jsxs)(a.default,{href:r.path,className:"flex flex-col items-center space-y-1 ".concat(t?"text-purple-600":"text-gray-500"),children:[(0,n.jsx)(r.icon,{className:"h-6 w-6"}),(0,n.jsx)("span",{className:"text-xs",children:r.label})]},r.path)})})})},u=e=>{let{children:r}=e;return(0,s.useEffect)(()=>{console.log("Layout 組件已渲染")},[]),(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,n.jsx)("main",{className:"pb-[83px]",children:r}),(0,n.jsx)(l,{})]})}},6501:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return l},a:function(){return u}});var n=t(7437),s=t(2265),a=t(3301),c=t(1361),o=t(5978);let i=(0,s.createContext)({user:null,loading:!0,isAdmin:!1,logout:async()=>{}}),l=e=>{let{children:r}=e,[t,l]=(0,s.useState)(null),[u,d]=(0,s.useState)(!0),[h,g]=(0,s.useState)(!1),x=async e=>{try{let r=await (0,o.QT)((0,o.JU)(c.db,"users",e));r.exists()&&g(!0===r.data().isAdmin)}catch(e){console.error("Error checking admin status:",e),g(!1)}};(0,s.useEffect)(()=>{let e=(0,a.Aj)(c.I,async e=>{l(e),e?await x(e.uid):g(!1),d(!1)});return()=>e()},[]);let f=async()=>{d(!0);try{await (0,a.w7)(c.I),l(null),console.log("User logged out successfully.")}catch(e){console.error("Error signing out:",e)}finally{d(!1)}};return(0,n.jsx)(i.Provider,{value:{user:t,loading:u,logout:f,isAdmin:h},children:r})},u=()=>(0,s.useContext)(i)},5326:function(e,r,t){"use strict";t.d(r,{a4:function(){return j},bq:function(){return h},jt:function(){return i},sV:function(){return d},A:function(){return y},Uh:function(){return u},aL:function(){return m},XR:function(){return x},Ho:function(){return g},zm:function(){return E},p5:function(){return l},et:function(){return v},isAdminUser:function(){return w},HP:function(){return I},xO:function(){return p},i1:function(){return b},Hf:function(){return f},Lj:function(){return k}});var n=t(738),s=t(5978),a=t(3301);let c=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),o=(0,s.ad)(c);(0,a.v0)(c);let i=async(e,r,t)=>{if(!e)return console.error("User ID is required to add history entry."),null;try{let n={userId:e,date:s.EK.fromDate(new Date),...t,birthdate:r},a=await (0,s.ET)((0,s.hJ)(o,"userHistory",e,"entries"),n);return console.log("History entry written with ID: ",a.id),a.id}catch(e){return console.error("Error adding document: ",e),null}},l=async e=>{if(!e)return console.error("User ID is required to get history."),[];try{let r=(0,s.hJ)(o,"userHistory",e,"entries"),t=(0,s.IO)(r,(0,s.Xo)("date","desc"),(0,s.b9)(20)),n=await (0,s.PL)(t),a=[];return n.forEach(e=>{a.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(a.length," history entries for user ").concat(e)),a}catch(e){return console.error("Error getting documents: ",e),[]}},u=async(e,r)=>{if(!e||!r)return console.error("User ID and Entry ID are required to delete history entry."),!1;try{return await (0,s.oe)((0,s.JU)(o,"userHistory",e,"entries",r)),console.log("History entry with ID: ".concat(r," deleted successfully for user ").concat(e,".")),!0}catch(e){return console.error("Error deleting document: ",e),!1}},d=async e=>{if(!e)return console.error("User ID is required to delete all history."),!1;try{let r=(0,s.hJ)(o,"userHistory",e,"entries"),t=(0,s.IO)(r),n=await (0,s.PL)(t),a=[];return n.forEach(e=>{a.push((0,s.oe)(e.ref))}),await Promise.all(a),console.log("All history entries deleted successfully for user ".concat(e,".")),!0}catch(e){return console.error("Error deleting all user history: ",e),!1}},h=async e=>{try{let r=await (0,s.ET)((0,s.hJ)(o,"courses"),{...e,createdAt:s.EK.fromDate(new Date)});return console.log("Course written with ID: ",r.id),r.id}catch(e){return console.error("Error adding course document: ",e),null}},g=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"date",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"desc";try{let t=(0,s.hJ)(o,"courses"),n=(0,s.IO)(t,(0,s.Xo)(e,r)),a=await (0,s.PL)(n),c=[];return a.forEach(e=>{c.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(c.length," courses")),c}catch(e){return console.error("Error getting course documents: ",e),[]}},x=async e=>{if(!e)return null;try{let r=(0,s.JU)(o,"courses",e),t=await (0,s.QT)(r);if(t.exists())return{id:t.id,...t.data()};return console.log("No such course document!"),null}catch(e){return console.error("Error getting course document: ",e),null}},f=async(e,r)=>{if(!e)return!1;try{let t=(0,s.JU)(o,"courses",e);return await (0,s.r7)(t,r),console.log("Course with ID: ".concat(e," updated successfully.")),!0}catch(e){return console.error("Error updating course document: ",e),!1}},y=async e=>{if(!e)return!1;try{return await (0,s.oe)((0,s.JU)(o,"courses",e)),console.log("Course with ID: ".concat(e," deleted successfully.")),!0}catch(e){return console.error("Error deleting course document: ",e),!1}},p=async e=>{let r=(0,s.hJ)(o,"bookings");return(await (0,s.ET)(r,e)).id},m=async()=>{let e=(0,s.hJ)(o,"bookings"),r=(0,s.IO)(e,(0,s.Xo)("createdAt","desc"));return(await (0,s.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))},b=async(e,r)=>{let t=(0,s.JU)(o,"bookings",e);await (0,s.r7)(t,{status:r})};async function w(e){try{let r=(0,s.hJ)(o,"admin_users"),t=(0,s.IO)(r,(0,s.ar)("email","==",e));return!(await (0,s.PL)(t)).empty}catch(e){return console.error("檢查管理員狀態時發生錯誤:",e),!1}}async function j(e){try{let r=(0,s.hJ)(o,"admin_users");await (0,s.ET)(r,{email:e,createdAt:new Date().toISOString()})}catch(e){throw console.error("添加管理員時發生錯誤:",e),e}}let v=async e=>{if(!e)return null;try{let r=(0,s.JU)(o,"user_profiles",e),t=await (0,s.QT)(r);if(t.exists())return{id:t.id,...t.data()};return null}catch(e){return console.error("獲取用戶資料時發生錯誤:",e),null}},k=async(e,r)=>{if(!e)return!1;try{let t=(0,s.JU)(o,"user_profiles",e),n=new Date().toISOString();return(await (0,s.QT)(t)).exists()?await (0,s.r7)(t,{...r,updatedAt:n}):await (0,s.pl)(t,{...r,createdAt:n,updatedAt:n}),!0}catch(e){return console.error("更新用戶資料時發生錯誤:",e),!1}},E=async e=>{if(!e)return null;try{let r=new Date().toISOString().split("T")[0],t=(0,s.hJ)(o,"deepseek_answer"),n=(0,s.IO)(t,(0,s.ar)("userId","==",e),(0,s.ar)("date","==",r),(0,s.b9)(1)),a=await (0,s.PL)(n);if(!a.empty){let e=a.docs[0];return{id:e.id,...e.data()}}return null}catch(e){return console.error("Error getting deepseek answer:",e),null}},I=async e=>{try{return(await (0,s.ET)((0,s.hJ)(o,"deepseek_answer"),{...e,createdAt:s.EK.fromDate(new Date)})).id}catch(e){return console.error("Error saving deepseek answer:",e),null}}},1361:function(e,r,t){"use strict";t.d(r,{I:function(){return o},db:function(){return i}});var n=t(738),s=t(3301),a=t(5978);let c=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),o=(0,s.v0)(c),i=(0,a.ad)(c)}},function(e){e.O(0,[358,982,699,943,705,971,117,744],function(){return e(e.s=9375)}),_N_E=e.O()}]);