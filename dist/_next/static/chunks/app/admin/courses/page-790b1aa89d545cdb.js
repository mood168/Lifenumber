(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[630],{282:function(e,t,r){Promise.resolve().then(r.bind(r,8180))},8180:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r(7437),a=r(2265),s=r(4710),i=r(6501),l=r(5326);function o(){var e,t;let{user:r,loading:o}=(0,i.a)(),[c,u]=(0,a.useState)([]),[d,h]=(0,a.useState)(!0),[m,x]=(0,a.useState)(!1),[g,f]=(0,a.useState)(null),[y,p]=(0,a.useState)(!1),[b,j]=(0,a.useState)(null),v=async()=>{h(!0);try{let e=await (0,l.Ho)();u(e)}catch(e){console.error("獲取課程數據時發生錯誤:",e)}finally{h(!1)}};(0,a.useEffect)(()=>{o||(async()=>{if(r){let e=await (0,l.isAdminUser)(r.email||"");j(e),e&&v()}else j(!1)})()},[r,o]);let w=async e=>{if(e.preventDefault(),!g)return;h(!0);let t=!1;if(y){let e=g.id;e?t=await (0,l.Hf)(e,g):(console.error("Editing mode but no course ID found!"),t=!1,alert("編輯失敗：找不到課程 ID。"))}else N(g)?t=!!await (0,l.bq)(g):(alert("請填寫所有必填欄位！"),t=!1);t?(v(),x(!1),f(null),p(!1),alert(y?"課程更新成功！":"課程新增成功！")):(y||N(g))&&!1===t&&alert(y?"課程更新失敗！":"課程新增失敗！"),h(!1)},N=e=>!!(e.title&&e.subtitle&&e.description&&e.instructor&&e.duration&&void 0!==e.rating&&void 0!==e.students&&e.location&&e.date&&e.image&&e.register_url&&e.price&&e.tag),k=async e=>{e&&window.confirm("確定要刪除此課程嗎？")&&(h(!0),await (0,l.A)(e)?(v(),alert("課程刪除成功！")):alert("課程刪除失敗！"),h(!1))},I=e=>{f(e),p(!0),x(!0)},E=e=>{let{name:t,value:r}=e.target;f(e=>e?{...e,[t]:r}:{[t]:r})};if(null===b||o)return(0,n.jsx)(s.default,{children:(0,n.jsx)("div",{className:"text-center p-4",children:"檢查權限中..."})});if(!b)return(0,n.jsx)(s.default,{children:(0,n.jsx)("div",{className:"text-center p-4",children:"您沒有權限訪問此頁面。"})});let D="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-800 dark:text-white bg-white dark:bg-gray-700",C="block text-sm font-medium text-gray-700 dark:text-gray-300";return(0,n.jsx)(s.default,{children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-4 text-center text-gray-700 dark:text-gray-300",children:"課程管理"}),(0,n.jsx)("div",{className:"mb-4 text-center",children:(0,n.jsx)("button",{onClick:()=>{f({}),p(!1),x(!0)},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors duration-300",children:"新增課程"})}),m&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:y?"編輯課程":"新增課程"}),(0,n.jsxs)("form",{onSubmit:w,className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"title",className:C,children:"標題"}),(0,n.jsx)("input",{type:"text",name:"title",id:"title",value:(null==g?void 0:g.title)||"",onChange:E,required:!0,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"subtitle",className:C,children:"副標題"}),(0,n.jsx)("input",{type:"text",name:"subtitle",id:"subtitle",value:(null==g?void 0:g.subtitle)||"",onChange:E,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"description",className:C,children:"描述"}),(0,n.jsx)("textarea",{name:"description",id:"description",value:(null==g?void 0:g.description)||"",onChange:E,required:!0,rows:3,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"instructor",className:C,children:"講師"}),(0,n.jsx)("input",{type:"text",name:"instructor",id:"instructor",value:(null==g?void 0:g.instructor)||"",onChange:E,required:!0,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"duration",className:C,children:"時長"}),(0,n.jsx)("input",{type:"text",name:"duration",id:"duration",value:(null==g?void 0:g.duration)||"",onChange:E,required:!0,className:D})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[" ",(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"rating",className:C,children:"評分 (0-5)"}),(0,n.jsx)("input",{type:"number",step:"0.1",min:"0",max:"5",name:"rating",id:"rating",value:null!==(e=null==g?void 0:g.rating)&&void 0!==e?e:"",onChange:E,required:!0,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"students",className:C,children:"學員數"}),(0,n.jsx)("input",{type:"number",min:"0",name:"students",id:"students",value:null!==(t=null==g?void 0:g.students)&&void 0!==t?t:"",onChange:E,required:!0,className:D})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"location",className:C,children:"地點"}),(0,n.jsx)("input",{type:"text",name:"location",id:"location",value:(null==g?void 0:g.location)||"",onChange:E,required:!0,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"date",className:C,children:"日期 (YYYY/MM/DD)"}),(0,n.jsx)("input",{type:"text",name:"date",id:"date",value:(null==g?void 0:g.date)||"",onChange:E,required:!0,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"image",className:C,children:"圖片 URL"}),(0,n.jsx)("input",{type:"url",name:"image",id:"image",value:(null==g?void 0:g.image)||"",onChange:E,required:!0,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"register_url",className:C,children:"報名網址"}),(0,n.jsx)("input",{type:"url",name:"register_url",id:"register_url",value:(null==g?void 0:g.register_url)||"",onChange:E,required:!0,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"price",className:C,children:"價格"}),(0,n.jsx)("input",{type:"text",name:"price",id:"price",value:(null==g?void 0:g.price)||"",onChange:E,required:!0,className:D})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"tag",className:C,children:"標籤 (例如：熱門, 額滿)"}),(0,n.jsx)("input",{type:"text",name:"tag",id:"tag",value:(null==g?void 0:g.tag)||"",onChange:E,className:D})]}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3 pt-3",children:[(0,n.jsx)("button",{type:"button",onClick:()=>{x(!1),f(null),p(!1)},className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"取消"}),(0,n.jsx)("button",{type:"submit",disabled:d,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:d?"處理中...":y?"更新課程":"新增課程"})]})]})]})}),(0,n.jsx)("div",{className:"mt-6 space-y-4",children:d&&!m?(0,n.jsx)("p",{className:"text-center text-gray-600 dark:text-gray-300",children:"正在加載課程列表..."}):c.length>0?c.map(e=>(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white",children:e.title}),(0,n.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.date," - ",e.location]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:["學員數: ",e.students]}),(0,n.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:["價格: ",e.price]})]}),(0,n.jsxs)("div",{className:"space-x-2 flex-shrink-0",children:[(0,n.jsx)("button",{onClick:()=>I(e),className:"px-3 py-1 text-sm bg-yellow-500 text-white rounded hover:bg-yellow-600",children:"編輯"}),(0,n.jsx)("button",{onClick:()=>k(e.id),className:"px-3 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600",children:"刪除"})]})]},e.id)):!d&&(0,n.jsx)("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"目前沒有課程資料。請點擊上方按鈕遷移或新增。"})})]})})}},4710:function(e,t,r){"use strict";r.d(t,{default:function(){return u}});var n=r(7437),a=r(2265),s=r(7648),i=r(9376),l=r(9089),o=r(6501),c=()=>{let e=(0,i.usePathname)(),{isAdmin:t}=(0,o.a)(),r=[{icon:l.xng,label:"首頁",path:"/"},{icon:l.nGB,label:"課程",path:"/classcourse"},{icon:l.QJe,label:"運勢",path:"/daily"},{icon:l.Xws,label:"我的",path:"/profile"},{icon:l.p4t,label:"設定",path:"/settings"},...t?[{icon:l.W95,label:"報名管理",path:"/admin/bookings"}]:[]];return(0,n.jsx)("div",{className:"fixed bottom-0 w-full bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 z-50",children:(0,n.jsx)("div",{className:"flex justify-around items-center h-[83px] px-6 pb-8 pt-2",children:r.map(t=>{let r=e===t.path;return(0,n.jsxs)(s.default,{href:t.path,className:"flex flex-col items-center space-y-1 ".concat(r?"text-purple-600":"text-gray-500"),children:[(0,n.jsx)(t.icon,{className:"h-6 w-6"}),(0,n.jsx)("span",{className:"text-xs",children:t.label})]},t.path)})})})},u=e=>{let{children:t}=e;return(0,a.useEffect)(()=>{console.log("Layout 組件已渲染")},[]),(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,n.jsx)("main",{className:"pb-[83px]",children:t}),(0,n.jsx)(c,{})]})}},6501:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return c},a:function(){return u}});var n=r(7437),a=r(2265),s=r(3301),i=r(1361),l=r(5978);let o=(0,a.createContext)({user:null,loading:!0,isAdmin:!1,logout:async()=>{}}),c=e=>{let{children:t}=e,[r,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),[h,m]=(0,a.useState)(!1),x=async e=>{try{let t=await (0,l.QT)((0,l.JU)(i.db,"users",e));t.exists()&&m(!0===t.data().isAdmin)}catch(e){console.error("Error checking admin status:",e),m(!1)}};(0,a.useEffect)(()=>{let e=(0,s.Aj)(i.I,async e=>{c(e),e?await x(e.uid):m(!1),d(!1)});return()=>e()},[]);let g=async()=>{d(!0);try{await (0,s.w7)(i.I),c(null),console.log("User logged out successfully.")}catch(e){console.error("Error signing out:",e)}finally{d(!1)}};return(0,n.jsx)(o.Provider,{value:{user:r,loading:u,logout:g,isAdmin:h},children:t})},u=()=>(0,a.useContext)(o)},5326:function(e,t,r){"use strict";r.d(t,{a4:function(){return v},bq:function(){return h},jt:function(){return o},sV:function(){return d},A:function(){return f},Uh:function(){return u},aL:function(){return p},XR:function(){return x},Ho:function(){return m},zm:function(){return k},p5:function(){return c},et:function(){return w},isAdminUser:function(){return j},HP:function(){return I},xO:function(){return y},i1:function(){return b},Hf:function(){return g},Lj:function(){return N}});var n=r(738),a=r(5978),s=r(3301);let i=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),l=(0,a.ad)(i);(0,s.v0)(i);let o=async(e,t,r)=>{if(!e)return console.error("User ID is required to add history entry."),null;try{let n={userId:e,date:a.EK.fromDate(new Date),...r,birthdate:t},s=await (0,a.ET)((0,a.hJ)(l,"userHistory",e,"entries"),n);return console.log("History entry written with ID: ",s.id),s.id}catch(e){return console.error("Error adding document: ",e),null}},c=async e=>{if(!e)return console.error("User ID is required to get history."),[];try{let t=(0,a.hJ)(l,"userHistory",e,"entries"),r=(0,a.IO)(t,(0,a.Xo)("date","desc"),(0,a.b9)(20)),n=await (0,a.PL)(r),s=[];return n.forEach(e=>{s.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(s.length," history entries for user ").concat(e)),s}catch(e){return console.error("Error getting documents: ",e),[]}},u=async(e,t)=>{if(!e||!t)return console.error("User ID and Entry ID are required to delete history entry."),!1;try{return await (0,a.oe)((0,a.JU)(l,"userHistory",e,"entries",t)),console.log("History entry with ID: ".concat(t," deleted successfully for user ").concat(e,".")),!0}catch(e){return console.error("Error deleting document: ",e),!1}},d=async e=>{if(!e)return console.error("User ID is required to delete all history."),!1;try{let t=(0,a.hJ)(l,"userHistory",e,"entries"),r=(0,a.IO)(t),n=await (0,a.PL)(r),s=[];return n.forEach(e=>{s.push((0,a.oe)(e.ref))}),await Promise.all(s),console.log("All history entries deleted successfully for user ".concat(e,".")),!0}catch(e){return console.error("Error deleting all user history: ",e),!1}},h=async e=>{try{let t=await (0,a.ET)((0,a.hJ)(l,"courses"),{...e,createdAt:a.EK.fromDate(new Date)});return console.log("Course written with ID: ",t.id),t.id}catch(e){return console.error("Error adding course document: ",e),null}},m=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"date",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"desc";try{let r=(0,a.hJ)(l,"courses"),n=(0,a.IO)(r,(0,a.Xo)(e,t)),s=await (0,a.PL)(n),i=[];return s.forEach(e=>{i.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(i.length," courses")),i}catch(e){return console.error("Error getting course documents: ",e),[]}},x=async e=>{if(!e)return null;try{let t=(0,a.JU)(l,"courses",e),r=await (0,a.QT)(t);if(r.exists())return{id:r.id,...r.data()};return console.log("No such course document!"),null}catch(e){return console.error("Error getting course document: ",e),null}},g=async(e,t)=>{if(!e)return!1;try{let r=(0,a.JU)(l,"courses",e);return await (0,a.r7)(r,t),console.log("Course with ID: ".concat(e," updated successfully.")),!0}catch(e){return console.error("Error updating course document: ",e),!1}},f=async e=>{if(!e)return!1;try{return await (0,a.oe)((0,a.JU)(l,"courses",e)),console.log("Course with ID: ".concat(e," deleted successfully.")),!0}catch(e){return console.error("Error deleting course document: ",e),!1}},y=async e=>{let t=(0,a.hJ)(l,"bookings");return(await (0,a.ET)(t,e)).id},p=async()=>{let e=(0,a.hJ)(l,"bookings"),t=(0,a.IO)(e,(0,a.Xo)("createdAt","desc"));return(await (0,a.PL)(t)).docs.map(e=>({id:e.id,...e.data()}))},b=async(e,t)=>{let r=(0,a.JU)(l,"bookings",e);await (0,a.r7)(r,{status:t})};async function j(e){try{let t=(0,a.hJ)(l,"admin_users"),r=(0,a.IO)(t,(0,a.ar)("email","==",e));return!(await (0,a.PL)(r)).empty}catch(e){return console.error("檢查管理員狀態時發生錯誤:",e),!1}}async function v(e){try{let t=(0,a.hJ)(l,"admin_users");await (0,a.ET)(t,{email:e,createdAt:new Date().toISOString()})}catch(e){throw console.error("添加管理員時發生錯誤:",e),e}}let w=async e=>{if(!e)return null;try{let t=(0,a.JU)(l,"user_profiles",e),r=await (0,a.QT)(t);if(r.exists())return{id:r.id,...r.data()};return null}catch(e){return console.error("獲取用戶資料時發生錯誤:",e),null}},N=async(e,t)=>{if(!e)return!1;try{let r=(0,a.JU)(l,"user_profiles",e),n=new Date().toISOString();return(await (0,a.QT)(r)).exists()?await (0,a.r7)(r,{...t,updatedAt:n}):await (0,a.pl)(r,{...t,createdAt:n,updatedAt:n}),!0}catch(e){return console.error("更新用戶資料時發生錯誤:",e),!1}},k=async e=>{if(!e)return null;try{let t=new Date().toISOString().split("T")[0],r=(0,a.hJ)(l,"deepseek_answer"),n=(0,a.IO)(r,(0,a.ar)("userId","==",e),(0,a.ar)("date","==",t),(0,a.b9)(1)),s=await (0,a.PL)(n);if(!s.empty){let e=s.docs[0];return{id:e.id,...e.data()}}return null}catch(e){return console.error("Error getting deepseek answer:",e),null}},I=async e=>{try{return(await (0,a.ET)((0,a.hJ)(l,"deepseek_answer"),{...e,createdAt:a.EK.fromDate(new Date)})).id}catch(e){return console.error("Error saving deepseek answer:",e),null}}},1361:function(e,t,r){"use strict";r.d(t,{I:function(){return l},db:function(){return o}});var n=r(738),a=r(3301),s=r(5978);let i=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),l=(0,a.v0)(i),o=(0,s.ad)(i)}},function(e){e.O(0,[358,982,699,943,705,971,117,744],function(){return e(e.s=282)}),_N_E=e.O()}]);