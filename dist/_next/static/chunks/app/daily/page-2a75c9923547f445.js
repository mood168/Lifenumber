(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379],{5077:function(e,r,t){Promise.resolve().then(t.bind(t,3325))},4710:function(e,r,t){"use strict";t.d(r,{default:function(){return u}});var n=t(7437),a=t(2265),s=t(7648),o=t(9376),i=t(9089),c=t(6501),l=()=>{let e=(0,o.usePathname)(),{isAdmin:r}=(0,c.a)(),t=[{icon:i.xng,label:"首頁",path:"/"},{icon:i.nGB,label:"課程",path:"/classcourse"},{icon:i.QJe,label:"運勢",path:"/daily"},{icon:i.Xws,label:"我的",path:"/profile"},{icon:i.p4t,label:"設定",path:"/settings"},...r?[{icon:i.W95,label:"報名管理",path:"/admin/bookings"}]:[]];return(0,n.jsx)("div",{className:"fixed bottom-0 w-full bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 z-50",children:(0,n.jsx)("div",{className:"flex justify-around items-center h-[83px] px-6 pb-8 pt-2",children:t.map(r=>{let t=e===r.path;return(0,n.jsxs)(s.default,{href:r.path,className:"flex flex-col items-center space-y-1 ".concat(t?"text-purple-600":"text-gray-500"),children:[(0,n.jsx)(r.icon,{className:"h-6 w-6"}),(0,n.jsx)("span",{className:"text-xs",children:r.label})]},r.path)})})})},u=e=>{let{children:r}=e;return(0,a.useEffect)(()=>{console.log("Layout 組件已渲染")},[]),(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,n.jsx)("main",{className:"pb-[83px]",children:r}),(0,n.jsx)(l,{})]})}},6501:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return l},a:function(){return u}});var n=t(7437),a=t(2265),s=t(3301),o=t(1361),i=t(5978);let c=(0,a.createContext)({user:null,loading:!0,isAdmin:!1,logout:async()=>{}}),l=e=>{let{children:r}=e,[t,l]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),[h,f]=(0,a.useState)(!1),p=async e=>{try{let r=await (0,i.QT)((0,i.JU)(o.db,"users",e));r.exists()&&f(!0===r.data().isAdmin)}catch(e){console.error("Error checking admin status:",e),f(!1)}};(0,a.useEffect)(()=>{let e=(0,s.Aj)(o.I,async e=>{l(e),e?await p(e.uid):f(!1),d(!1)});return()=>e()},[]);let y=async()=>{d(!0);try{await (0,s.w7)(o.I),l(null),console.log("User logged out successfully.")}catch(e){console.error("Error signing out:",e)}finally{d(!1)}};return(0,n.jsx)(c.Provider,{value:{user:t,loading:u,logout:y,isAdmin:h},children:r})},u=()=>(0,a.useContext)(c)},3325:function(e,r,t){"use strict";t.r(r);var n=t(7437),a=t(2265),s=t(4710),o=t(9089),i=t(6501),c=t(5326);r.default=()=>{let{user:e}=(0,i.a)(),[r,t]=(0,a.useState)(!0),[l,u]=(0,a.useState)(null),d=new Date().toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric",weekday:"long"}),h=async(e,r,t)=>{try{var n,a,s,o;let i="\n        請以專業占卜師的角度，為一位名叫".concat(e,"的").concat("male"===t?"男性":"女性","（出生日期：").concat(r,"）解讀今日運勢。\n        請分別從以下四個面向進行分析，每個面向180-250字：\n        1. 整體運勢\n        2. 感情運勢\n        3. 事業運勢\n        4. 財運運勢\n        請用溫和積極的語氣，給出具體的建議。\n      "),c=await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer sk-eff332de370945f499451ac09597417e"},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"user",content:i}],temperature:.7})}),l=(await c.json()).choices[0].message.content.split(/(?=\d\.\s)/),u=e=>e.replace(/---/g,"").replace(/###/g,"").trim();return{overall:u((null===(n=l[1])||void 0===n?void 0:n.replace(/1\.\s整體運勢[:：]?\s*/,""))||"無法獲取運勢"),love:u((null===(a=l[2])||void 0===a?void 0:a.replace(/2\.\s感情運勢[:：]?\s*/,""))||"無法獲取運勢"),career:u((null===(s=l[3])||void 0===s?void 0:s.replace(/3\.\s事業運勢[:：]?\s*/,""))||"無法獲取運勢"),wealth:u((null===(o=l[4])||void 0===o?void 0:o.replace(/4\.\s財運運勢[:：]?\s*/,""))||"無法獲取運勢")}}catch(e){throw console.error("Deepseek API error:",e),e}};(0,a.useEffect)(()=>{(async()=>{if(!(null==e?void 0:e.uid)){t(!1);return}try{let r=new Date().toISOString().split("T")[0],t=await (0,c.zm)(e.uid);if(t)u(t);else{let t=await (0,c.et)(e.uid);if(!(null==t?void 0:t.realName)||!(null==t?void 0:t.birthDate)||!(null==t?void 0:t.gender))throw Error("用戶資料不完整");let n=await h(t.realName,t.birthDate,t.gender),a={userId:e.uid,date:r,...n};await (0,c.HP)(a),u(a)}}catch(e){console.error("Error loading fortune:",e)}finally{t(!1)}})()},[e]);let f=[{icon:o.QJe,title:"整體運勢",description:(null==l?void 0:l.overall)||"請先完善個人資料"},{icon:o.$0H,title:"感情運勢",description:(null==l?void 0:l.love)||"請先完善個人資料"},{icon:o.I8D,title:"事業運勢",description:(null==l?void 0:l.career)||"請先完善個人資料"},{icon:o.sI3,title:"財運運勢",description:(null==l?void 0:l.wealth)||"請先完善個人資料"}];return e?(0,n.jsx)(s.default,{children:(0,n.jsxs)("div",{className:"p-6 space-y-6",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:"每日運勢"}),(0,n.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:d})]}),r?(0,n.jsx)("div",{className:"flex justify-center items-center h-40",children:(0,n.jsx)(o.fCD,{className:"w-8 h-8 text-purple-600 animate-spin"})}):(0,n.jsx)("div",{className:"space-y-4",children:f.map((e,r)=>(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3 mb-2",children:[(0,n.jsx)(e.icon,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"}),(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.title})]}),(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-300 whitespace-pre-line",children:e.description})]},r))})]})}):(0,n.jsx)(s.default,{children:(0,n.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,n.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"請先登入以查看每日運勢"})})})}},5326:function(e,r,t){"use strict";t.d(r,{a4:function(){return v},bq:function(){return h},jt:function(){return c},sV:function(){return d},A:function(){return m},Uh:function(){return u},aL:function(){return w},XR:function(){return p},Ho:function(){return f},zm:function(){return E},p5:function(){return l},et:function(){return I},isAdminUser:function(){return b},HP:function(){return k},xO:function(){return g},i1:function(){return x},Hf:function(){return y},Lj:function(){return j}});var n=t(738),a=t(5978),s=t(3301);let o=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),i=(0,a.ad)(o);(0,s.v0)(o);let c=async(e,r,t)=>{if(!e)return console.error("User ID is required to add history entry."),null;try{let n={userId:e,date:a.EK.fromDate(new Date),...t,birthdate:r},s=await (0,a.ET)((0,a.hJ)(i,"userHistory",e,"entries"),n);return console.log("History entry written with ID: ",s.id),s.id}catch(e){return console.error("Error adding document: ",e),null}},l=async e=>{if(!e)return console.error("User ID is required to get history."),[];try{let r=(0,a.hJ)(i,"userHistory",e,"entries"),t=(0,a.IO)(r,(0,a.Xo)("date","desc"),(0,a.b9)(20)),n=await (0,a.PL)(t),s=[];return n.forEach(e=>{s.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(s.length," history entries for user ").concat(e)),s}catch(e){return console.error("Error getting documents: ",e),[]}},u=async(e,r)=>{if(!e||!r)return console.error("User ID and Entry ID are required to delete history entry."),!1;try{return await (0,a.oe)((0,a.JU)(i,"userHistory",e,"entries",r)),console.log("History entry with ID: ".concat(r," deleted successfully for user ").concat(e,".")),!0}catch(e){return console.error("Error deleting document: ",e),!1}},d=async e=>{if(!e)return console.error("User ID is required to delete all history."),!1;try{let r=(0,a.hJ)(i,"userHistory",e,"entries"),t=(0,a.IO)(r),n=await (0,a.PL)(t),s=[];return n.forEach(e=>{s.push((0,a.oe)(e.ref))}),await Promise.all(s),console.log("All history entries deleted successfully for user ".concat(e,".")),!0}catch(e){return console.error("Error deleting all user history: ",e),!1}},h=async e=>{try{let r=await (0,a.ET)((0,a.hJ)(i,"courses"),{...e,createdAt:a.EK.fromDate(new Date)});return console.log("Course written with ID: ",r.id),r.id}catch(e){return console.error("Error adding course document: ",e),null}},f=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"date",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"desc";try{let t=(0,a.hJ)(i,"courses"),n=(0,a.IO)(t,(0,a.Xo)(e,r)),s=await (0,a.PL)(n),o=[];return s.forEach(e=>{o.push({id:e.id,...e.data()})}),console.log("Fetched ".concat(o.length," courses")),o}catch(e){return console.error("Error getting course documents: ",e),[]}},p=async e=>{if(!e)return null;try{let r=(0,a.JU)(i,"courses",e),t=await (0,a.QT)(r);if(t.exists())return{id:t.id,...t.data()};return console.log("No such course document!"),null}catch(e){return console.error("Error getting course document: ",e),null}},y=async(e,r)=>{if(!e)return!1;try{let t=(0,a.JU)(i,"courses",e);return await (0,a.r7)(t,r),console.log("Course with ID: ".concat(e," updated successfully.")),!0}catch(e){return console.error("Error updating course document: ",e),!1}},m=async e=>{if(!e)return!1;try{return await (0,a.oe)((0,a.JU)(i,"courses",e)),console.log("Course with ID: ".concat(e," deleted successfully.")),!0}catch(e){return console.error("Error deleting course document: ",e),!1}},g=async e=>{let r=(0,a.hJ)(i,"bookings");return(await (0,a.ET)(r,e)).id},w=async()=>{let e=(0,a.hJ)(i,"bookings"),r=(0,a.IO)(e,(0,a.Xo)("createdAt","desc"));return(await (0,a.PL)(r)).docs.map(e=>({id:e.id,...e.data()}))},x=async(e,r)=>{let t=(0,a.JU)(i,"bookings",e);await (0,a.r7)(t,{status:r})};async function b(e){try{let r=(0,a.hJ)(i,"admin_users"),t=(0,a.IO)(r,(0,a.ar)("email","==",e));return!(await (0,a.PL)(t)).empty}catch(e){return console.error("檢查管理員狀態時發生錯誤:",e),!1}}async function v(e){try{let r=(0,a.hJ)(i,"admin_users");await (0,a.ET)(r,{email:e,createdAt:new Date().toISOString()})}catch(e){throw console.error("添加管理員時發生錯誤:",e),e}}let I=async e=>{if(!e)return null;try{let r=(0,a.JU)(i,"user_profiles",e),t=await (0,a.QT)(r);if(t.exists())return{id:t.id,...t.data()};return null}catch(e){return console.error("獲取用戶資料時發生錯誤:",e),null}},j=async(e,r)=>{if(!e)return!1;try{let t=(0,a.JU)(i,"user_profiles",e),n=new Date().toISOString();return(await (0,a.QT)(t)).exists()?await (0,a.r7)(t,{...r,updatedAt:n}):await (0,a.pl)(t,{...r,createdAt:n,updatedAt:n}),!0}catch(e){return console.error("更新用戶資料時發生錯誤:",e),!1}},E=async e=>{if(!e)return null;try{let r=new Date().toISOString().split("T")[0],t=(0,a.hJ)(i,"deepseek_answer"),n=(0,a.IO)(t,(0,a.ar)("userId","==",e),(0,a.ar)("date","==",r),(0,a.b9)(1)),s=await (0,a.PL)(n);if(!s.empty){let e=s.docs[0];return{id:e.id,...e.data()}}return null}catch(e){return console.error("Error getting deepseek answer:",e),null}},k=async e=>{try{return(await (0,a.ET)((0,a.hJ)(i,"deepseek_answer"),{...e,createdAt:a.EK.fromDate(new Date)})).id}catch(e){return console.error("Error saving deepseek answer:",e),null}}},1361:function(e,r,t){"use strict";t.d(r,{I:function(){return i},db:function(){return c}});var n=t(738),a=t(3301),s=t(5978);let o=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyAxZitnvh6eB2hvnPj66YzEH0QwqHKSBJ0",authDomain:"lifenumber-4165b.firebaseapp.com",projectId:"lifenumber-4165b",storageBucket:"lifenumber-4165b.appspot.com",messagingSenderId:"354586740442",appId:"1:354586740442:web:34ae0d75dfb4b066a707e3",measurementId:"G-TQDKFKKVPP"}),i=(0,a.v0)(o),c=(0,s.ad)(o)}},function(e){e.O(0,[358,982,699,943,705,971,117,744],function(){return e(e.s=5077)}),_N_E=e.O()}]);